- hosts:
  - es-nodes
  roles:
    - role: ansible-beats
  vars:
    beats_version:  "{{ es_version}}"
    node_name: "{{hostvars[inventory_hostname].node_name}}"
    #cluster_name: "{{hostvars[inventory_hostname].cluster_name}}"
    #es_host: "{{hostvars[inventory_hostname].node_dns_name}}"
    es_host:   "{{ ansible_eth0.ipv4.address }}"
    #elastic_pass: "{{hostvars[inventory_hostname].elastic_pass}}"
    #elastic_mon_pass: "{{hostvars[inventory_hostname].elastic_mon_pass}}"
    beat: metricbeat
    beat_conf:
      fields:
        env: mon
        node_name: "{{node_name}}"
        host: "{{es_host}}"
        cluster: "{{cluster_name}}"
      name: "{{cluster_name}}-{{node_name}}"
      tags: ["elk", "es-node","metrics"]
      metricbeat.modules:
        - module: system
        - module: elasticsearch
          xpack.enabled: true
          period: 10s
          hosts:
            - "https://{{es_host}}:9200"
          username: remote_monitoring_user
          password: "{{remote_monitoring_user_pass}}"
          ssl.verification_mode: none

    output_conf:
        elasticsearch:
          hosts: "{{elasticsearch_mon_host}}"
          protocol: "https"
          username: "beats_user"
          password: "{{beats_mon_user_pass}}"
          ssl.verification_mode: none
          loadbalance: true
          worker: 2



#[/var/log/elasticsearch/*_access.log /var/log/elasticsearch/*_audit.log /var/log/elasticsearch/*_audit.json]
#[/var/log/elasticsearch/*_deprecation.log /var/log/elasticsearch/*_deprecation.json]
#[/var/log/elasticsearch/gc.log.[0-9]* /var/log/elasticsearch/gc.log]
#[/var/log/elasticsearch/*.log /var/log/elasticsearch/*_server.json]
#[/var/log/elasticsearch/*_index_search_slowlog.log /var/log/elasticsearch/*_index_indexing_slowlog.log /var/log/elasticsearch/*_index_search_slowlog.json /var/log/elasticsearch/*_index_indexing_slowlog.json]